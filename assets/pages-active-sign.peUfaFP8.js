import{d as s,p as a,U as e,q as t,K as l,V as c,c as i,w as n,e as u,o,f as d,g as r,a as g,t as f,l as m,j as _,F as k,k as v,b as p,h,i as y,G as b,E as S,P as x}from"./index-B3-jzm13.js";import{_ as w}from"./gold-coin-icon.-hroadw7.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";const D=j(s({__name:"sign",setup(s){const j=a({}),D=a(!1),T=a(0),C=a([]),F=e(()=>{const s=[],a=new Date;for(let e=0;e<7;e++){const t=new Date(a);t.setDate(a.getDate()-a.getDay()+e+1),s.push({date:`${t.getMonth()+1}.${t.getDate()}`,isSigned:e<T.value})}return s}),I=[{id:"auth",name:"实名认证",score:18,icon:"/static/images/my/payment-methods.png",url:"/pages/auser/shiming"},{id:"card",name:"绑定银行卡",score:28,icon:"/static/images/my/asset-icon.png",url:"/pages/auser/bankList"},{id:"invest",name:"每日投资",score:88,icon:"/static/images/home/lottery.png",url:"/pages/fuli/index"},{id:"lottery",name:"每日抽奖",score:5,icon:"/static/images/home/lottery.png",url:"/pages/active/turntable"},{id:"sign",name:"每日签到",score:2,icon:"/static/images/home/check-in.png",isSignTask:!0},{id:"join",name:"加入善倍盈",score:188,icon:"/static/images/home/team.png",url:"/pages/ahome/index"}];async function L(){if(!D.value)try{const s=await c.doSign();if(1===s.code){b({title:"签到成功 +积分",icon:"success"}),D.value=!0,T.value++,j.value.score=(Number(j.value.score)||0)+1;const s=C.value.find(s=>s.isSignTask);s&&(s.status=1)}else b({title:s.msg||"签到失败",icon:"none"})}catch{b({title:"签到成功 (模拟)",icon:"success"}),D.value=!0,T.value++}}function P(){x()}return t(()=>{!async function(){try{const[s,a,e]=await Promise.all([l.getUserInfo(),c.getSignInfo(),c.getTaskList()]);1===s.code&&(j.value=s.data),1===a.code&&(D.value=1===a.data.is_sign,T.value=a.data.days||0);const t=e.data||[];C.value=I.map(s=>{if(s.isSignTask)return{...s,status:D.value?1:0};const a=t.find(a=>a.key===s.id);return{...s,status:a?a.status:0}})}catch(s){C.value=I.map(s=>({...s,status:0})),void 0===j.value.score&&(j.value.score=1948)}}()}),(s,a)=>{const e=r,t=u,l=m,c=y;return o(),i(t,{class:"sign-page"},{default:n(()=>[d(t,{class:"header"},{default:n(()=>[d(t,{class:"nav-bar"},{default:n(()=>[d(t,{class:"back-btn",onClick:P},{default:n(()=>[d(e,{class:"icon"},{default:n(()=>[g("‹")]),_:1})]),_:1}),d(e,{class:"nav-title"},{default:n(()=>[g("每日签到")]),_:1})]),_:1}),d(t,{class:"header-content"},{default:n(()=>[d(t,{class:"score-box"},{default:n(()=>[d(e,{class:"label"},{default:n(()=>[g("我的积分")]),_:1}),d(e,{class:"score"},{default:n(()=>[g(f(j.value.score||0),1)]),_:1})]),_:1}),d(l,{class:"sign-bg-img",src:"/shanzhili-h5/static/images/home/check-in-img.png",mode:"aspectFit"})]),_:1})]),_:1}),d(t,{class:"sign-card"},{default:n(()=>[d(t,{class:"sign-header"},{default:n(()=>[D.value?(o(),i(e,{key:1,class:"sign-title"},{default:n(()=>[g("已签到 "),d(e,{class:"days"},{default:n(()=>[g(f(T.value),1)]),_:1}),g(" 天")]),_:1})):(o(),i(e,{key:0,class:"sign-title"},{default:n(()=>[g("今日未签到")]),_:1}))]),_:1}),d(t,{class:"week-list"},{default:n(()=>[(o(!0),_(k,null,v(F.value,(s,a)=>(o(),i(t,{class:p(["day-item",{signed:s.isSigned}]),key:a},{default:n(()=>[d(t,{class:"coin-icon"},{default:n(()=>[s.isSigned?(o(),i(e,{key:0,class:"coin-text"},{default:n(()=>[g("已签")]),_:1})):(o(),i(e,{key:1,class:"coin-val"},{default:n(()=>[g("+1")]),_:1})),s.isSigned?h("",!0):(o(),i(l,{key:2,src:w,mode:"aspectFit",class:"coin-img"}))]),_:2},1024),d(e,{class:"date-text"},{default:n(()=>[g(f(s.date),1)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1}),d(c,{class:p(["sign-btn",{disabled:D.value}]),onClick:L},{default:n(()=>[g(f(D.value?"今日已签到":"立即签到"),1)]),_:1},8,["class"])]),_:1}),d(t,{class:"task-section"},{default:n(()=>[d(t,{class:"section-header"},{default:n(()=>[d(e,{class:"title"},{default:n(()=>[g("任务中心")]),_:1}),d(e,{class:"subtitle"},{default:n(()=>[g("每日0:00刷新")]),_:1})]),_:1}),d(t,{class:"task-list"},{default:n(()=>[(o(!0),_(k,null,v(C.value,(s,a)=>(o(),i(t,{class:"task-item",key:a},{default:n(()=>[d(t,{class:"task-left"},{default:n(()=>[d(t,{class:"task-icon-box"},{default:n(()=>[d(l,{src:s.icon,mode:"aspectFit",class:"task-icon"},null,8,["src"])]),_:2},1024),d(t,{class:"task-info"},{default:n(()=>[d(e,{class:"task-name"},{default:n(()=>[g(f(s.name),1)]),_:2},1024),d(t,{class:"task-reward"},{default:n(()=>[d(l,{src:w,class:"coin-mini"}),d(e,null,{default:n(()=>[g("积分+"+f(s.score),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),d(c,{class:p(["task-btn",{completed:1===s.status}]),onClick:a=>function(s){1!==s.status&&(s.isSignTask?L():s.url&&S({url:s.url}))}(s)},{default:n(()=>[g(f(1===s.status?"已完成":"去完成"),1)]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-3951b2ec"]]);export{D as default};
